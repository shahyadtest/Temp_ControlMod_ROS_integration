"use client"

import { postData } from "@/services/API";
import { Spinner } from "@heroui/react";
import Image from "next/image";
import { useRouter } from "next/navigation";
import React, { useState } from "react";
import toast, { Toaster } from "react-hot-toast";

const FriendRequestItem = ({ userInfo }) => {
  const [loadingType, setLoadingType] = useState(null);
  const router = useRouter();

  const submitRequestHandler = (answer) => {
    setLoadingType(answer);

    postData("/friends/update-friendship-status", {
      requestId: userInfo._id,
      accept: answer === "accept" || false,
    })
      .then((res) => {
        toast.success(res.data.message, {
          style: {
            borderRadius: "10px",
            background: "#040e1c",
            color: "#fff",
            fontSize: "14px",
          },
        });

        router.refresh();
      })
      .catch((err) => {
        setLoadingType(null);

        toast.error(err.response.data.message, {
          style: {
            borderRadius: "10px",
            background: "#040e1c",
            color: "#fff",
            fontSize: "14px",
          },
        });
      });
  };

  return (
    <div className="w-full h-14 px-4 rounded-2xl bg-primaryLightTheme flex items-center justify-between">
      <Toaster />

      <div className="flex items-center gap-2">
        <Image
          src={"/avatar.png"}
          width={50}
          height={50}
          className="size-8 rounded-xl object-cover -mr-0.5"
          alt={`کاربر ${userInfo.sender.nickName}`}
        />

        <div className="flex flex-col">
          <span className="text-xs">{userInfo.sender.nickName}</span>
          <span className="text-[10px] text-blueColor">
            {userInfo.sender.userName}
          </span>
        </div>
      </div>

      <div className="flex items-center gap-6 text-xs">
        {loadingType ? (
          <Spinner
            classNames={{
              base: "flex !flex-row",
              label: `${
                loadingType === "accept" ? "text-success" : "text-danger"
              } text-xs`,
            }}
            size="sm"
            color={loadingType === "accept" ? "success" : "danger"}
            label={
              loadingType === "accept"
                ? "تایید درخواست دوستی..."
                : "رد درخواست دوستی..."
            }
          />
        ) : (
          <>
            <button
              onClick={() => submitRequestHandler("accept")}
              className="text-success flex items-center gap-1"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width={16}
                height={16}
                viewBox="0 0 16 16"
              >
                <path
                  d="M8.248 0.8322240000000001C7.805744 0.9229120000000001 7.386064 1.17256 7.114624 1.5064000000000002C7.076336 1.553472 6.481264 2.3948 5.792224 3.376C5.1032 4.3572 4.537776 5.162096 4.535728 5.164656C4.53368 5.167232 4.495392 5.1199200000000005 4.4506239999999995 5.0595360000000005C4.284736 4.835776 3.98312 4.583232 3.73104 4.4570240000000005C3.451488 4.3170720000000005 3.163696 4.252015999999999 2.824 4.252015999999999C2.55368 4.252015999999999 2.35136 4.285648 2.1295680000000003 4.367424C1.5304000000000002 4.5883519999999995 1.0600319999999999 5.0883840000000005 0.879856 5.695936C0.797504 5.973712000000001 0.8001119999999999 5.854304 0.8001760000000001 9.328C0.800224 11.415712 0.805952 12.604992000000001 0.816304 12.672C0.9228959999999999 13.362432000000002 1.365024 13.947536 1.992 14.227920000000001C2.268112 14.351408 2.518528 14.403584 2.831888 14.40296C3.387232 14.40184 3.864224 14.203104 4.2567520000000005 13.809296C4.432288 13.633216000000001 4.557984 13.460416 4.644736 13.276L4.695536000000001 13.168000000000001 4.788576 13.168000000000001C4.852528 13.168000000000001 4.990176000000001 13.197696 5.228800000000001 13.262976C7.200144000000001 13.802256 9.047296000000001 14.079856 10.6652 14.079968000000001C11.135408 14.080016 11.391328 14.027568 11.752 13.857248C12.36432 13.568112 12.999600000000001 12.95208 13.560032 12.104000000000001C14.339968 10.923776 14.958432 9.36816 15.15352 8.096C15.20032 7.79072 15.21184 7.287520000000001 15.177856 7.032C15.112688 6.542015999999999 14.944304 6.09448 14.675744000000002 5.697472C14.198816 4.992416 13.390032 4.42184 12.55104 4.1985280000000005C12.213696 4.108736 12.212048000000001 4.108608 11.284 4.100848C10.447456 4.09384 10.416 4.092496000000001 10.416 4.063472C10.416 4.046928 10.449616 3.8008640000000002 10.490704 3.5166880000000003C10.602208000000001 2.7455680000000005 10.597088 2.485504 10.4628 2.0979360000000002C10.236495999999999 1.444816 9.630608 0.935424 8.94672 0.823296C8.752544 0.791472 8.426448 0.795632 8.248 0.8322240000000001M8.472 1.95232C8.295392 1.987664 8.143408 2.0770239999999998 8.016720000000001 2.219984C7.971888 2.270592 7.244176 3.296064 6.3996 4.4988L4.864 6.685600000000001 4.864 9.3508L4.864 12.016 4.933088 12.016C4.971072 12.016 5.05208 12.029424 5.113087999999999 12.045824000000001C5.9378720000000005 12.267664000000002 6.170783999999999 12.328272000000002 6.464 12.397392C7.924016 12.7416 9.290304 12.920384 10.552 12.932352000000002C10.878048000000001 12.935456 10.951696 12.931712 11.040000000000001 12.907568C11.582784 12.759200000000002 12.220384000000001 12.130495999999999 12.786544000000001 11.185343999999999C13.441312 10.092288 13.952208 8.682879999999999 14.04848 7.704C14.08552 7.327568 14.034096 6.963984000000001 13.898864 6.645808C13.660288000000001 6.084576 13.060944 5.569936 12.380336 5.34192C12.076272000000001 5.240048 12.134255999999999 5.244015999999999 10.8 5.233584L9.576 5.224 9.505728 5.186512C9.40016 5.130208 9.291360000000001 5.020096 9.238976000000001 4.916576C9.1636 4.767600000000001 9.166752 4.70368 9.294559999999999 3.791824C9.448576 2.692864 9.44248 2.7480320000000003 9.423344 2.6255520000000003C9.372368 2.2992 9.09584 2.011568 8.777056 1.9533440000000002C8.669984000000001 1.9337760000000002 8.566336 1.93344 8.472 1.95232M2.584 5.4218720000000005C2.4341280000000003 5.464928 2.321712 5.53344 2.1983200000000003 5.656896C2.0678240000000003 5.787472 1.9962080000000002 5.917104 1.960176 6.088C1.924656 6.256416000000001 1.924608 12.399168 1.960112 12.568C2.0300160000000003 12.900336 2.320736 13.187648 2.646944 13.246784C2.95904 13.303376 3.2266399999999997 13.221248 3.4495999999999998 13.00048C3.578272 12.873072 3.665696 12.713552 3.6947840000000003 12.553056000000002C3.706688 12.487376000000001 3.71192 11.491264 3.7117280000000004 9.321056C3.711488 6.6900640000000005 3.707824 6.166912 3.6889920000000003 6.078048C3.623696 5.7700000000000005 3.358672 5.4976 3.044752 5.415824C2.923824 5.38432 2.70464 5.3872 2.584 5.4218720000000005"
                  stroke="none"
                  fill="currentColor"
                  fillRule="evenodd"
                  strokeWidth={0.016}
                />
              </svg>

              <span>تایید</span>
            </button>
            <button
              onClick={() => submitRequestHandler("reject")}
              className="text-danger flex items-center gap-1"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width={16}
                height={16}
                viewBox="0 0 16 16"
                className="-rotate-180"
              >
                <path
                  d="M8.248 0.8322240000000001C7.805744 0.9229120000000001 7.386064 1.17256 7.114624 1.5064000000000002C7.076336 1.553472 6.481264 2.3948 5.792224 3.376C5.1032 4.3572 4.537776 5.162096 4.535728 5.164656C4.53368 5.167232 4.495392 5.1199200000000005 4.4506239999999995 5.0595360000000005C4.284736 4.835776 3.98312 4.583232 3.73104 4.4570240000000005C3.451488 4.3170720000000005 3.163696 4.252015999999999 2.824 4.252015999999999C2.55368 4.252015999999999 2.35136 4.285648 2.1295680000000003 4.367424C1.5304000000000002 4.5883519999999995 1.0600319999999999 5.0883840000000005 0.879856 5.695936C0.797504 5.973712000000001 0.8001119999999999 5.854304 0.8001760000000001 9.328C0.800224 11.415712 0.805952 12.604992000000001 0.816304 12.672C0.9228959999999999 13.362432000000002 1.365024 13.947536 1.992 14.227920000000001C2.268112 14.351408 2.518528 14.403584 2.831888 14.40296C3.387232 14.40184 3.864224 14.203104 4.2567520000000005 13.809296C4.432288 13.633216000000001 4.557984 13.460416 4.644736 13.276L4.695536000000001 13.168000000000001 4.788576 13.168000000000001C4.852528 13.168000000000001 4.990176000000001 13.197696 5.228800000000001 13.262976C7.200144000000001 13.802256 9.047296000000001 14.079856 10.6652 14.079968000000001C11.135408 14.080016 11.391328 14.027568 11.752 13.857248C12.36432 13.568112 12.999600000000001 12.95208 13.560032 12.104000000000001C14.339968 10.923776 14.958432 9.36816 15.15352 8.096C15.20032 7.79072 15.21184 7.287520000000001 15.177856 7.032C15.112688 6.542015999999999 14.944304 6.09448 14.675744000000002 5.697472C14.198816 4.992416 13.390032 4.42184 12.55104 4.1985280000000005C12.213696 4.108736 12.212048000000001 4.108608 11.284 4.100848C10.447456 4.09384 10.416 4.092496000000001 10.416 4.063472C10.416 4.046928 10.449616 3.8008640000000002 10.490704 3.5166880000000003C10.602208000000001 2.7455680000000005 10.597088 2.485504 10.4628 2.0979360000000002C10.236495999999999 1.444816 9.630608 0.935424 8.94672 0.823296C8.752544 0.791472 8.426448 0.795632 8.248 0.8322240000000001M8.472 1.95232C8.295392 1.987664 8.143408 2.0770239999999998 8.016720000000001 2.219984C7.971888 2.270592 7.244176 3.296064 6.3996 4.4988L4.864 6.685600000000001 4.864 9.3508L4.864 12.016 4.933088 12.016C4.971072 12.016 5.05208 12.029424 5.113087999999999 12.045824000000001C5.9378720000000005 12.267664000000002 6.170783999999999 12.328272000000002 6.464 12.397392C7.924016 12.7416 9.290304 12.920384 10.552 12.932352000000002C10.878048000000001 12.935456 10.951696 12.931712 11.040000000000001 12.907568C11.582784 12.759200000000002 12.220384000000001 12.130495999999999 12.786544000000001 11.185343999999999C13.441312 10.092288 13.952208 8.682879999999999 14.04848 7.704C14.08552 7.327568 14.034096 6.963984000000001 13.898864 6.645808C13.660288000000001 6.084576 13.060944 5.569936 12.380336 5.34192C12.076272000000001 5.240048 12.134255999999999 5.244015999999999 10.8 5.233584L9.576 5.224 9.505728 5.186512C9.40016 5.130208 9.291360000000001 5.020096 9.238976000000001 4.916576C9.1636 4.767600000000001 9.166752 4.70368 9.294559999999999 3.791824C9.448576 2.692864 9.44248 2.7480320000000003 9.423344 2.6255520000000003C9.372368 2.2992 9.09584 2.011568 8.777056 1.9533440000000002C8.669984000000001 1.9337760000000002 8.566336 1.93344 8.472 1.95232M2.584 5.4218720000000005C2.4341280000000003 5.464928 2.321712 5.53344 2.1983200000000003 5.656896C2.0678240000000003 5.787472 1.9962080000000002 5.917104 1.960176 6.088C1.924656 6.256416000000001 1.924608 12.399168 1.960112 12.568C2.0300160000000003 12.900336 2.320736 13.187648 2.646944 13.246784C2.95904 13.303376 3.2266399999999997 13.221248 3.4495999999999998 13.00048C3.578272 12.873072 3.665696 12.713552 3.6947840000000003 12.553056000000002C3.706688 12.487376000000001 3.71192 11.491264 3.7117280000000004 9.321056C3.711488 6.6900640000000005 3.707824 6.166912 3.6889920000000003 6.078048C3.623696 5.7700000000000005 3.358672 5.4976 3.044752 5.415824C2.923824 5.38432 2.70464 5.3872 2.584 5.4218720000000005"
                  stroke="none"
                  fill="currentColor"
                  fillRule="evenodd"
                  strokeWidth={0.016}
                />
              </svg>

              <span>رد</span>
            </button>
          </>
        )}
      </div>
    </div>
  );
};

export default FriendRequestItem;
